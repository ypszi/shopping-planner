<!doctype html>
<html lang="en">
{% include 'head.html.twig' %}
<body>
<div class="container-fluid">
    <h1 id="top" class="display-6">LÃ¡ssuk mi van otthon...</h1>
    <form action="/storage/ingredients" method="post">
        {% for ingredientCategory, availableIngredients in ingredientStorage %}
            <h1 id="{{ ingredientCategory|url_encode }}" class="mt-2 fs-3">
                {{ ingredientCategory }}
                <a class="anchor-link" href="#{{ ingredientCategory|url_encode }}"></a>
            </h1>

            {% for availableIngredient in availableIngredients %}
                {% set availableIngredientName = availableIngredient.name %}
                {% set availableIngredientNameKey = availableIngredientName|replace({' ': '_'}) %}
                <fieldset class="row mb-2">
                    <div class="col-md-8">
                        <div class="form-check form-switch">
                            <input
                                    type="checkbox"
                                    role="switch"
                                    id="{{ availableIngredientNameKey }}"
                                    value="{{ availableIngredientName }}"
                                    name="ingredient-{{ availableIngredientNameKey }}"
                                    class="form-check-input"
                                    onchange="if (this.checked) {
                                            document.getElementById('portion-{{ availableIngredientNameKey }}').disabled = '';
                                            document.getElementById('measure-{{ availableIngredientNameKey }}').disabled = ''
                                            } else {
                                            document.getElementById('portion-{{ availableIngredientNameKey }}').disabled = 'disabled';
                                            document.getElementById('measure-{{ availableIngredientNameKey }}').disabled = 'disabled';
                                            }"
                                    {% if availableIngredient.portion != 0 %}checked="checked"{% endif %}
                            >
                            <label for="{{ availableIngredientNameKey }}" class="form-check-label">{{ availableIngredientName }}</label>
                            <output id="portion-output-{{ availableIngredientNameKey }}">({{ availableIngredient.ingredientPortion }})</output>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input
                                    type="range"
                                    id="portion-{{ availableIngredientNameKey }}"
                                    value="{{ availableIngredient.portion }}"
                                    name="portion-{{ availableIngredientNameKey }}"
                                    class="form-range"
                                    min="0"
                                    max="{{ ingredientMeasureMapByName[availableIngredient.name].max ?? ingredientMeasureMapByCategory[ingredientCategory].max }}"
                                    step="{{ ingredientMeasureMapByName[availableIngredient.name].step ?? ingredientMeasureMapByCategory[ingredientCategory].step }}"
                                    oninput="document.getElementById('portion-output-{{ availableIngredientNameKey }}').value = '(' + (Math.round(this.value * 100) / 100) + ' {{ availableIngredient.measurePreference.value }})'"
                                    {% if availableIngredient.portion == 0 %}disabled="disabled"{% endif %}
                            >
                            <input
                                    type="hidden"
                                    id="measure-{{ availableIngredientNameKey }}"
                                    value="{{ availableIngredient.measurePreference.value }}"
                                    name="measure-{{ availableIngredientNameKey }}"
                                    {% if availableIngredient.portion == 0 %}disabled="disabled"{% endif %}
                            >
                        </div>
                    </div>
                </fieldset>
            {% endfor %}
        {% endfor %}

        <div class="sticky-bottom">
            <div class="row justify-content-center sticky-bottom-btn-row">
                <button
                        class="btn btn-warning col-3 text-center"
                        type="button"
                        onclick="window.location.href=window.location.origin">
                    HOME
                </button>
                <div class="col-1"></div>
                <a
                        class="btn btn-info col-3 text-center"
                        href="#top">
                    TO THE TOP
                </a>
                <div class="col-1"></div>
                <button
                        class="btn btn-primary col-3 text-center"
                        type="submit">
                    SAVE
                </button>
            </div>
        </div>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    {% include 'dark-theme.js.twig' %}
</script>
</body>
</html>
